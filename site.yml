---
- name: Build PVE VDI Thin Client
  hosts: localhost
  connection: local
  become: true

  vars:
    vdi_tls_verify: false
    vdi_auth_backend: "pve"

    vdi_hosts:
      "192.168.2.201": 8006
      "192.168.2.212": 8006
      "192.168.2.215": 8006
      "192.168.2.204": 8006

    # add your SSH pubkey here (or pass in via --extra-vars / vars file)
    vdi_admin_ssh_pubkey: "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIGs8e1xn2rNm4khYFUUHZxYkvqRlUosajkq0j9SrTR8t ansible"

  roles:
    - pve_vdi_thinclient

  tasks:
    - name: Add Kurt SSH key for thin client management
      ansible.builtin.authorized_key:
        user: "{{ vdi_local_user | default('kurt') }}"
        key: "{{ vdi_admin_ssh_pubkey }}"
        state: present

    - name: Reboot to complete VDI thin client setup
      ansible.builtin.reboot:
        msg: "Rebooting to complete VDI thin client setup"
        reboot_timeout: 900